{"version":3,"sources":["meteor://ðŸ’»app/server/post.js"],"names":[],"mappings":";;;;;;;;AAAA,MAAM,CAAC,OAAO,CAAC;AACd,QAAO,EAAC,UAAS,GAAG,EAAC;AACpB,MAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;EACjB;AACD,SAAQ,EAAC,UAAS,EAAE,EAAC,GAAG,EAAC;AACxB,MAAI,CAAC,MAAM,CAAC,EAAC,GAAG,EAAC,EAAE,EAAC,EAAC,EAAC,IAAI,EAAC,GAAG,EAAC,CAAC,CAAC;EACjC;AACD,WAAU,EAAC,UAAS,EAAE,EAAC;AACtB,MAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAM,CAAC,MAAM,CAAC,EAAC,GAAG,EAAC,EAAE,EAAC,CAAC,CAAC;EAExB;AACD,oBAAmB,EAAC,UAAS,EAAE,EAAC,KAAK,EAAC;AACrC,MAAI,CAAC,OAAO,EAAE,CAAC;AACf,SAAO,CAAC,GAAG,CAAC,MAAM,GAAC,KAAK,CAAC,CAAC;AAC1B,MAAI,CAAC,MAAM,CAAC,EAAC,GAAG,EAAC,EAAE,EAAC,EAAC,EAAC,KAAK,EAAC,EAAC,MAAM,EAAC,KAAK,EAAC,EAAC,CAAC,CAAC;EAC7C;AACD,gBAAe,EAAC,UAAS,EAAE,EAAC,KAAK,EAAC;AACjC,MAAI,CAAC,OAAO,EAAE,CAAC;AACf,MAAI,CAAC,MAAM,CAAC,EAAC,GAAG,EAAC,EAAE,EAAC,EAAC,EAAC,KAAK,EAAC,EAAC,MAAM,EAAC,KAAK,EAAC,EAAC,CAAC;EAC5C;AACD,WAAU,EAAC,UAAS,EAAE,EAAC;AACtB,MAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;EAChB;AACD,UAAS,EAAC,UAAS,GAAG,EAAC;AACtB,QAAM,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;EACnB;AACD,aAAY,EAAC,UAAS,EAAE,EAAC,GAAG,EAAC;AAC5B,QAAM,CAAC,MAAM,CAAC,EAAC,GAAG,EAAH,GAAG,EAAC,EAAE,EAAF,EAAE,EAAC,EAAC,EAAC,IAAI,EAAC,GAAG,EAAC,CAAC;EAClC;AACD,gBAAe,EAAC,UAAS,EAAE,EAAC,KAAK,EAAC;AACjC,MAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAM,CAAC,MAAM,CAAC,EAAC,GAAG,EAAC,EAAE,EAAC,EAAC,EAAC,IAAI,EAAC,EAAC,MAAM,EAAC,KAAK,EAAC,EAAC,CAAC;EAC7C;AACD,kBAAiB,EAAC,UAAS,EAAE,EAAC;AAC7B,QAAM,CAAC,MAAM,CAAC,EAAC,GAAG,EAAC,EAAE,EAAC,EAAC,EAAC,IAAI,EAAC,EAAC,MAAM,EAAC,EAAE,EAAC,EAAC,CAAC,CAAC;EAC3C;AACD,aAAY,EAAC,UAAS,EAAE,EAAC;AACxB,QAAM,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;EAClB;AACD,mBAAkB,EAAC,UAAS,EAAE,EAAC,KAAK,EAAC;AACpC,MAAI,CAAC,OAAO,EAAE,CAAC;AACf,YAAU,CAAC,MAAM,CAAC,EAAC,GAAG,EAAC,EAAE,EAAC,EAAC,EAAC,IAAI,EAAC,EAAC,KAAK,EAAC,KAAK,EAAC,EAAC,CAAC;EAChD;AACD,cAAa,EAAC,UAAS,OAAO,EAAC,QAAQ,EAAC;AACvC,MAAI,CAAC,OAAO,EAAE,CAAC;AACZ,SAAO,sBAAsB,CAAC,OAAO,EAAC,QAAQ,CAAC,CAAC;EACnD;AACD,uBAAsB,EAAC,UAAS,OAAO,EAAC,OAAO,EAAC,QAAQ,EAAC;AACrD,MAAI,CAAC,OAAO,EAAE,CAAC;AACf,MAAI,MAAM,GAAG,oBAAoB,CAAC,OAAO,EAAC,OAAO,CAAC,CAAC;AACnD,MAAG,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,GAAG,CAAC,EAAC;AACjC,OAAI,IAAI,GAAG,EAAE,CAAC;AACX,SAAM,CAAC,OAAO,CAAC,UAAS,CAAC,EAAC;AACzB,YAAO,QAAQ;AACd,UAAK,IAAI;AACR,UAAI,IAAE,2BAA2B,GAAC,CAAC,CAAC,EAAE,CAAC,KAAK,GAAC,IAAI,GAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,EAAC,OAAO,CAAC,GAAC,WAAW,CAAC;AACjG,YAAM;AACP,UAAK,IAAI;AACR,UAAI,IAAE,2BAA2B,GAAC,CAAC,CAAC,EAAE,CAAC,KAAK,GAAC,IAAI,GAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,EAAC,OAAO,CAAC,GAAC,WAAW,CAAC;AACjG,YAAM;AACP,UAAK,IAAI;AACR,UAAI,IAAE,2BAA2B,GAAC,CAAC,CAAC,EAAE,CAAC,KAAK,GAAC,IAAI,GAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,EAAC,OAAO,CAAC,GAAC,WAAW,CAAC;AACjG,YAAM;AAAA,KACP;IACD,CAAC;AACF,UAAO,IAAI,CAAC;GACb,MAAI;AACJ,UAAO;GACP;EACF;AACD,mBAAkB,EAAC,UAAS,OAAO,EAAC,OAAO,EAAC,QAAQ,EAAC;AACnD,MAAI,CAAC,OAAO,EAAE,CAAC;AACf,MAAI,MAAM,GAAG,oBAAoB,CAAC,OAAO,EAAC,OAAO,CAAC,CAAC;AACnD,MAAG,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,GAAG,CAAC,EAAC;AACjC,OAAI,IAAI,GAAG,EAAE,CAAC;AACX,SAAM,CAAC,OAAO,CAAC,UAAS,CAAC,EAAC;AACzB,YAAO,QAAQ;AACd,UAAK,IAAI;AACR,UAAI,IAAE,2CAA2C,GAAC,CAAC,CAAC,EAAE,CAAC,KAAK,GAAC,IAAI,GAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,EAAC,OAAO,CAAC,GAAC,WAAW,CAAC;AACjH,YAAM;AACP,UAAK,IAAI;AACR,UAAI,IAAE,2CAA2C,GAAC,CAAC,CAAC,EAAE,CAAC,KAAK,GAAC,IAAI,GAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,EAAC,OAAO,CAAC,GAAC,WAAW,CAAC;AACjH,YAAM;AACP,UAAK,IAAI;AACR,UAAI,IAAE,2CAA2C,GAAC,CAAC,CAAC,EAAE,CAAC,KAAK,GAAC,IAAI,GAAC,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,EAAC,OAAO,CAAC,GAAC,WAAW,CAAC;AACjH,YAAM;AAAA,KACP;IACD,CAAC;AACF,UAAO,IAAI,CAAC;GACb,MAAI;AACJ,UAAO;GACP;EACF;;CAEH,CAAC;;;;;;;AAOF,cAAc,GAAG,UAAS,OAAO,EAAC,IAAI,EAAC;AACnC,KAAI,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,EAAC,wBAAwB,CAAC,CAAC;AACtD,KAAI,OAAO,GAAG,IAAI,MAAM,CAAC,GAAG,GAAC,IAAI,GAAC,GAAG,EAAE,IAAI,CAAC,CAAC;AAC7C,QAAO,GAAG,OAAO,CAAC,OAAO,CAAC,OAAO,EAAE,iBAAiB,CAAC,CAAC;AACtD,QAAO,GAAG,OAAO,CAAC,OAAO,CAAC,4CAA4C,EAAC,qBAAqB,CAAC,CAAC;AAC9F,QAAO,OAAO,CAAC;CAClB;;AAED,sBAAsB,GAAG,UAAS,OAAO,EAAC,UAAU,EAAC;AACpD,KAAI,MAAM,GAAE,EAAE,CAAC;AACf,KAAG,OAAO,EAAC;AACP,MAAI,KAAK,GAAG;AACR,MAAG,EAAC,CACA,EAAC,UAAU,EAAG,EAAC,MAAM,EAAG,IAAI,MAAM,CAAC,OAAO,EAAE,GAAG,CAAC,EAAC,EAAC,EAClD,EAAC,UAAU,EAAG,EAAC,MAAM,EAAG,IAAI,MAAM,CAAC,OAAO,EAAE,GAAG,CAAC,EAAC,EAAC,EAClD,EAAC,UAAU,EAAG,EAAC,MAAM,EAAG,IAAI,MAAM,CAAC,OAAO,EAAE,GAAG,CAAC,EAAC,EAAC,CACjD;GACR;AACD,QAAM,GAAG,IAAI,CAAC,IAAI,CAAC,EAAC,IAAI,EAAC,CAAC,EAAC,QAAQ,EAAC,SAAS,EAAC,EAAC,KAAK,CAAC,EAAC,CAAC,CAAC;AACxD,SAAO,CAAC,GAAG,CAAC,YAAY,GAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC;EAC5C,MAAI;AACJ,QAAM,GAAG,IAAI,CAAC,IAAI,CAAC,EAAC,QAAQ,EAAC,SAAS,EAAC,CAAC,CAAC;EACzC;AACD,KAAG,UAAU,EAAC;AACb,MAAI,UAAU,GAAE,EAAE,CAAC;AAChB,YAAU,GAAG,UAAU,CAAC,UAAU,CAAC,CAAC;AACpC,YAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;AAC5B,SAAO,CAAC,GAAG,CAAC,aAAa,GAAC,UAAU,CAAC,CAAC;AACtC,MAAI,KAAK,GAAG,EAAC,IAAI,EAAC,CAAC,EAAC,QAAQ,EAAC,SAAS,EAAC,EAAC,EAAC,QAAQ,EAAC,EAAC,GAAG,EAAC,UAAU,EAAC,EAAC,CAAC,EAAC;AACrE,QAAM,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;EAC7B;AACD,QAAO,MAAM,CAAC,KAAK,EAAE,CAAC;CACtB,wE","file":"/server/post.js","sourcesContent":["Meteor.methods({\n\taddpost:function(obj){\n\t\tpost.insert(obj);\n\t},\n\teditPost:function(id,obj){\n\t\tpost.update({_id:id},{$set:obj});\n\t},\n\tremoveFile:function(id){\n\t\tthis.unblock();\n\t\timages.remove({_id:id});\n\t\t\n\t},\n\tremoveIdImgFromPost:function(id,idImg){\n\t\tthis.unblock();\n\t\tconsole.log('id=='+idImg);\n\t\tpost.update({_id:id},{$pull:{images:idImg}});\n\t},\n\tupdateImagePost:function(id,idImg){\n\t\tthis.unblock();\n\t\tpost.update({_id:id},{$push:{images:idImg}})\n\t},\n\tremovePost:function(id){\n\t\tpost.remove(id);\n\t},\n\taddSlider:function(obj){\n\t\tslider.insert(obj);\n\t},\n\tupdateSlider:function(id,obj){\n\t\tslider.update({_id,id},{$set:obj})\n\t},\n\tupdateImgSlider:function(id,image){\n\t\tthis.unblock();\n\t\tslider.update({_id:id},{$set:{images:image}})\n\t},\n\tremoveIdImgSlider:function(id){\n\t\tslider.update({_id:id},{$set:{images:''}});\n\t},\n\tremoveSlider:function(id){\n\t\tslider.remove(id);\n\t},\n\tupdateImgBannerCat:function(id,image){\n\t\tthis.unblock();\n\t\tcategories.update({_id:id},{$set:{image:image}})\n\t},\n\tnumberRowPost:function(keyword,category){\n\t\tthis.unblock();\n\t    return getPagListBySearchPost(keyword,category);\n\t},\n\tgetListPostIdsBySearch:function(options,keyword,language){\n\t    this.unblock();\n\t    var result = listPostByPageSearch(options,keyword);\n\t    if(result && result.count() > 0){\n\t\t  var html = '';\n\t      result.forEach(function(v){\n\t      \tswitch(language){\n\t      \t\tcase 'en':\n\t      \t\t\thtml+='<li><a href=\"/postSearch/'+v.en.title+'\">'+searchTextBold(v.en.title,keyword)+'</a></li>';\n\t      \t\t\tbreak;\n\t      \t\tcase 'kh':\n\t      \t\t\thtml+='<li><a href=\"/postSearch/'+v.kh.title+'\">'+searchTextBold(v.kh.title,keyword)+'</a></li>';\n\t      \t\t\tbreak;\n\t      \t\tcase 'ch':\n\t      \t\t\thtml+='<li><a href=\"/postSearch/'+v.ch.title+'\">'+searchTextBold(v.ch.title,keyword)+'</a></li>';\n\t      \t\t\tbreak;\n\t      \t} \n\t      })\n\t      return html;\n\t    }else{\n\t    \treturn;\n\t    }\n  \t},\n  \tgetListSearchFront:function(options,keyword,language){\n\t    this.unblock();\n\t    var result = listPostByPageSearch(options,keyword);\n\t    if(result && result.count() > 0){\n\t\t  var html = '';\n\t      result.forEach(function(v){\n\t      \tswitch(language){\n\t      \t\tcase 'en':\n\t      \t\t\thtml+='<li><a class=\"link-search\" href=\"/search/'+v.en.title+'\">'+searchTextBold(v.en.title,keyword)+'</a></li>';\n\t      \t\t\tbreak;\n\t      \t\tcase 'kh':\n\t      \t\t\thtml+='<li><a class=\"link-search\" href=\"/search/'+v.kh.title+'\">'+searchTextBold(v.kh.title,keyword)+'</a></li>';\n\t      \t\t\tbreak;\n\t      \t\tcase 'ch':\n\t      \t\t\thtml+='<li><a class=\"link-search\" href=\"/search/'+v.ch.title+'\">'+searchTextBold(v.ch.title,keyword)+'</a></li>';\n\t      \t\t\tbreak;\n\t      \t} \n\t      })\n\t      return html;\n\t    }else{\n\t    \treturn;\n\t    }\n  \t}\n\n})\n\n// lugUrl = function(title){\n//     title = title.replace(\" \",'-');\n//     return title;\n// }\n\nsearchTextBold = function(src_str,term){\n    term = term.replace(/(\\s+)/,\"(<[^>]+>)*$1(<[^>]+>)*\");\n    var pattern = new RegExp(\"(\"+term+\")\", \"gi\");\n    src_str = src_str.replace(pattern, \"<mark>$1</mark>\");\n    src_str = src_str.replace(/(<mark>[^<>]*)((<[^>]+>)+)([^<>]*<\\/mark>)/,\"$1</mark>$2<mark>$4\");\n    return src_str;\n}\n\ngetPagListBySearchPost = function(keyword,categoryId){\n\tvar result= '';\n\tif(keyword){\n\t    var query = {\n\t        $or:[\n\t            {'en.title' : {$regex : new RegExp(keyword, \"i\")}},\n\t            {'kh.title' : {$regex : new RegExp(keyword, \"i\")}},\n\t            {'ch.title' : {$regex : new RegExp(keyword, \"i\")}}\n\t            ]    \n\t    }\n\t    result = post.find({$and:[{location:'product'},query]}); \n\t    console.log('dataCount='+result.count());\n\t}else{\n\t\tresult = post.find({location:'product'});\n\t}\n\tif(categoryId){\n\t\tvar catIdArray =[];\n\t    catIdArray = mapChildId(categoryId);\n\t    catIdArray.push(categoryId);\n\t    console.log('categoryId='+catIdArray);\n\t    var query = {$and:[{location:'product'},{category:{$in:catIdArray}}]}\n\t    result = post.find(query);\n\t}\n\treturn result.count();\n}"]}
{"version":3,"sources":["meteor://ðŸ’»app/server/userRole.js"],"names":[],"mappings":";;;;;;;;AAAA,MAAM,CAAC,OAAO,CAAC,YAAY;AACzB,MAAI,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,KAAK,EAAE,CAAC,MAAM,KAAK,CAAC,EAAE;AAC5C,QAAI,KAAK,GAAG,CACR,EAAC,IAAI,EAAC,OAAO,EAAC,KAAK,EAAC,iBAAiB,EAAC,KAAK,EAAC,CAAC,OAAO,CAAC,EAAC,EACtD,EAAC,IAAI,EAAC,eAAe,EAAC,KAAK,EAAC,iCAAiC,EAAC,KAAK,EAAC,CAAC,OAAO,CAAC,EAAC,CAC/E,CAAC;;AAEJ,KAAC,CAAC,IAAI,CAAC,KAAK,EAAE,UAAU,IAAI,EAAE;AAC5B,UAAI,EAAE,CAAC;;AAEP,QAAE,GAAG,QAAQ,CAAC,UAAU,CAAC;AACvB,aAAK,EAAE,IAAI,CAAC,KAAK;AACjB,gBAAQ,EAAE,UAAU;AACpB,eAAO,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE;OAC7B,CAAC,CAAC;;AAEH,UAAI,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;;;AAGzB,aAAK,CAAC,eAAe,CAAC,EAAE,EAAE,IAAI,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;OAClD;KAEF,CAAC,CAAC;GACJ;CACF,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,CAAC;AACb,YAAU,EAAE,UAAS,EAAE,EAAE;AACvB,WAAO,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;GAChC;AACD,gBAAc,EAAC,UAAS,EAAE,EAAC,QAAQ,EAAC;AAClC,WAAO,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,EAAC,EAAC,IAAI,EAAC,EAAC,KAAK,EAAC,QAAQ,EAAC,EAAC,CAAC,CAAC;GACxD;AACD,aAAW,EAAC,UAAS,EAAE,EAAC,SAAS,EAAC;AAChC,WAAO,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,EAAC,EAAC,IAAI,EAAC,SAAS,EAAC,CAAC,CAAC;GACjD;AACD,cAAY,EAAC,UAAS,QAAQ,EAAC,KAAK,EAAC,QAAQ,EAAC,IAAI,EAAC;AACjD,gBAAY,GAAC,QAAQ,CAAC,UAAU,CAAC;AAC7B,cAAQ,EAAC,QAAQ;AACjB,WAAK,EAAE,KAAK;AACZ,cAAQ,EAAE,QAAQ;KAClB,CAAC,CAAC;AACN,WAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;;AAE1B,SAAK,CAAC,YAAY,CAAC,YAAY,EAAE,CAAC,IAAI,CAAC,EAAE,SAAS,CAAC;GACpD;AACD,gBAAc,EAAC,UAAS,EAAE,EAAC,SAAS,EAAC,QAAQ,EAAC,QAAQ,EAAC,KAAK,EAAC;AAC3D,UAAM,CAAC,KAAK,CAAC,MAAM,CAAC,EAAC,GAAG,EAAC,EAAE,EAAC,EAAC,EAAC,IAAI,EAAC,EAAC,kBAAkB,EAAC,KAAK,EAAC,SAAS,EAAC,EAAC,SAAS,EAAC,SAAS,EAAC,QAAQ,EAAC,QAAQ,EAAC,QAAQ,EAAC,QAAQ,EAAC,EAAC,EAAC,CAAC,CAAC;AACpI,WAAO,IAAI,CAAC;GACb;AACD,eAAa,EAAC,YAAU;AACtB,QAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,EAAC,EAAC,MAAM,EAAC,EAAC,GAAG,EAAC,CAAC,EAAC,EAAC,CAAC,CAAC;AAClD,WAAO,IAAI,CAAC,KAAK,EAAE,CAAC;GACrB;AACD,qBAAmB,EAAC,UAAS,OAAO,EAAC;AACnC,QAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAI,IAAI,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,kBAAkB,EAAG,EAAC,MAAM,EAAG,IAAI,MAAM,CAAC,OAAO,EAAE,GAAG,CAAC,EAAC,EAAC,EAAC,EAAC,MAAM,EAAC,EAAC,GAAG,EAAC,CAAC,EAAC,EAAC,CAAC,CAAC;AAC3G,WAAO,CAAC,GAAG,CAAC,OAAO,GAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;AAClC,WAAO,IAAI,CAAC,KAAK,EAAE,CAAC;GACrB;AACD,gBAAc,EAAC,UAAS,OAAO,EAAC;AAC9B,QAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAI,MAAM,GAAG,cAAc,CAAC,OAAO,CAAC,CAAC;AACrC,QAAI,EAAE,GAAG,EAAE,CAAC;AACZ,QAAG,MAAM,CAAC,KAAK,EAAE,GAAG,CAAC,EAAC;AACpB,YAAM,CAAC,OAAO,CAAC,UAAS,CAAC,EAAC;AACxB,UAAE,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;OAChB,CAAC;AACF,aAAO,EAAE,CAAC;KACX;GACF;AACD,wBAAsB,EAAC,UAAS,OAAO,EAAC,OAAO,EAAC;AAC9C,QAAI,CAAC,OAAO,EAAE,CAAC;AACf,QAAI,MAAM,GAAG,oBAAoB,CAAC,OAAO,EAAC,OAAO,CAAC,CAAC;AACnD,QAAI,EAAE,GAAG,EAAE,CAAC;AACZ,WAAO,CAAC,GAAG,CAAC,OAAO,GAAC,MAAM,CAAC,KAAK,EAAE,CAAC;AACnC,QAAG,MAAM,CAAC,KAAK,EAAE,GAAG,CAAC,EAAC;AACpB,YAAM,CAAC,OAAO,CAAC,UAAS,CAAC,EAAC;AACxB,UAAE,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;OAChB,CAAC;AACF,aAAO,CAAC,GAAG,CAAC,MAAM,GAAC,EAAE,CAAC,CAAC;AACvB,aAAO,EAAE,CAAC;KACX;GACF;;CAGF,CAAC,CAAC,sE","file":"/server/userRole.js","sourcesContent":["Meteor.startup(function () {\r\n  if (Meteor.users.find().fetch().length === 0) {\r\n    var users = [\r\n        {name:\"admin\",email:\"admin@gmail.com\",roles:['admin']},\r\n        {name:\"kollbothkhmer\",email:\"kollbothkhmer@kollbothkhmer.com\",roles:['admin']}\r\n      ];\r\n\r\n    _.each(users, function (user) {\r\n      var id;\r\n\r\n      id = Accounts.createUser({\r\n        email: user.email,\r\n        password: \"679798DY\",\r\n        profile: { name: user.name }\r\n      });\r\n\r\n      if (user.roles.length > 0) {\r\n        // Need _id of existing user record so this call must come \r\n        // after `Accounts.createUser` or `Accounts.onCreate`\r\n        Roles.addUsersToRoles(id, user.roles, 'mygroup');\r\n      }\r\n\r\n    });\r\n  }\r\n});\r\n\r\nMeteor.methods({\r\n  deleteuser: function(id) {\r\n    return Meteor.users.remove(id);\r\n  },\r\n  updateUserRole:function(id,attrRole){\r\n    return Meteor.users.update(id,{$set:{roles:attrRole}});\r\n  },\r\n  updateEmail:function(id,attrEmail){\r\n    return Meteor.users.update(id,{$set:attrEmail});\r\n  },\r\n  registerUser:function(username,email,password,role){\r\n    targetUserId=Accounts.createUser({\r\n        username:username,\r\n        email: email,\r\n        password: password\r\n       });\r\n    console.log(targetUserId);\r\n    // Roles.setUserRoles(id,'member')\r\n    Roles.setUserRoles(targetUserId, [role], 'mygroup')\r\n  },\r\n  updateUserById:function(id,firstname,lastname,username,email){\r\n    Meteor.users.update({_id:id},{$set:{\"emails.0.address\":email,\"profile\":{firstname:firstname,lastname:lastname,username:username}}});\r\n    return true;\r\n  },\r\n  numberRowUser:function(){\r\n    this.unblock();\r\n    var user = Meteor.users.find({},{fields:{_id:1}});\r\n    return user.count();\r\n  },\r\n  numberRowUserSearch:function(keyword){\r\n    this.unblock();\r\n    var user = Meteor.users.find({ 'profile.username' : {$regex : new RegExp(keyword, \"i\")}},{fields:{_id:1}});\r\n    console.log('NUM=='+user.count());\r\n    return user.count();\r\n  },\r\n  getListUserIds:function(options){\r\n    this.unblock();\r\n    var result = listUserByPage(options);\r\n    var ID = [];\r\n    if(result.count() > 0){\r\n      result.forEach(function(v){\r\n        ID.push(v._id);\r\n      })\r\n      return ID;\r\n    }\r\n  },\r\n  getListUserIdsBySearch:function(options,keyword){\r\n    this.unblock();\r\n    var result = listUserByPageSearch(options,keyword);\r\n    var ID = [];\r\n    console.log('SER=='+result.count())\r\n    if(result.count() > 0){\r\n      result.forEach(function(v){\r\n        ID.push(v._id);\r\n      })\r\n      console.log('id=='+ID);\r\n      return ID;\r\n    }\r\n  }\r\n\r\n\r\n});\r\n"]}